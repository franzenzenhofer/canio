(function(){var q,j,V,W,U,T,X,H,Y,J,M,N=[].slice;j={utils:{initSampleCanvas:function(){var a,b;a=document.createElement("canvas");b=a.getContext("2d");a.width=0;a.height=0;this.getSampleCanvas=function(){return a};this.getSampleContext=function(){return b};return this.createImageData=b.createImageData?function(a,d){return b.createImageData(a,d)}:function(a,b){return new ImageData(a,b)}},getSampleCanvas:function(){this.initSampleCanvas();return this.getSampleCanvas()},getSampleContext:function(){this.initSampleCanvas();
return this.getSampleContext()},createImageData:function(a,b){this.initSampleCanvas();return this.createImageData(a,b)},clamp:function(a){return 255<a?255:0>a?0:a},buildMap:function(a){var b,c,d;c=[];b=0;for(d=void 0;256>b;)c[b]=255<(d=a(b))?255:0>d?0:d|0,b+=1;return c},applyMap:function(a,b,c){var d,e,f;d=0;e=a.length;for(f=[];d<e;)b[d]=c[a[d]],b[d+1]=c[a[d+1]],b[d+2]=c[a[d+2]],b[d+3]=a[d+3],f.push(d+=4);return f},mapRGB:function(a,b,c){return this.applyMap(a,b,this.buildMap(c))},getPixelIndex:function(a,
b,c,d,e){if(0>a||a>=c||0>b||b>=d)switch(e){case 1:a=0>a?0:a>=c?c-1:a;b=0>b?0:b>=d?d-1:b;break;case 2:a=0>(a%=c)?a+c:a;b=0>(b%=d)?b+d:b;break;default:return null}return b*c+a<<2},getPixel:function(a,b,c,d,e,f){if(0>b||b>=d||0>c||c>=e)switch(f){case 1:b=0>b?0:b>=d?d-1:b;c=0>c?0:c>=e?e-1:c;break;case 2:b=0>(b%=d)?b+d:b;c=0>(c%=e)?c+e:c;break;default:return 0}b=c*d+b<<2;return a[b+3]<<24|a[b]<<16|a[b+1]<<8|a[b+2]},getPixelByIndex:function(a,b){return a[b+3]<<24|a[b]<<16|a[b+1]<<8|a[b+2]},copyBilinear:function(a,
b,c,d,e,f,h,g){var i,k,m,p,l;i=0>b?b-1|0:b|0;k=0>c?c-1|0:c|0;b-=i;l=c-k;if(0<=i&&i<d-1&&0<=k&&k<e-1)if(e=k*d+i<<2,b||l)m=a[e+3]<<24|a[e]<<16|a[e+1]<<8|a[e+2],e+=4,c=a[e+3]<<24|a[e]<<16|a[e+1]<<8|a[e+2],e=e-8+(d<<2),p=a[e+3]<<24|a[e]<<16|a[e+1]<<8|a[e+2],e+=4,k=a[e+3]<<24|a[e]<<16|a[e+1]<<8|a[e+2];else{f[h]=a[e];f[h+1]=a[e+1];f[h+2]=a[e+2];f[h+3]=a[e+3];return}else if(m=this.getPixel(a,i,k,d,e,g),b||l)c=this.getPixel(a,i+1,k,d,e,g),p=this.getPixel(a,i,k+1,d,e,g),k=this.getPixel(a,i+1,k+1,d,e,g);else{f[h]=
m>>16&255;f[h+1]=m>>8&255;f[h+2]=m&255;f[h+3]=m>>24&255;return}g=1-b;i=1-l;e=((m>>16&255)*g+(c>>16&255)*b)*i+((p>>16&255)*g+(k>>16&255)*b)*l;d=((m>>8&255)*g+(c>>8&255)*b)*i+((p>>8&255)*g+(k>>8&255)*b)*l;a=((m&255)*g+(c&255)*b)*i+((p&255)*g+(k&255)*b)*l;b=((m>>24&255)*g+(c>>24&255)*b)*i+((p>>24&255)*g+(k>>24&255)*b)*l;f[h]=255<e?255:0>e?0:e|0;f[h+1]=255<d?255:0>d?0:d|0;f[h+2]=255<a?255:0>a?0:a|0;return f[h+3]=255<b?255:0>b?0:b|0},rgbToHsl:function(a,b,c){var d,e,f,h,g,i,a=a/255,b=b/255,c=c/255;h=a>
b?a>c?a:c:b>c?b:c;g=a<b?a<c?a:c:b<c?b:c;d=h-g;i=e=0;f=(g+h)/2;0!==d&&(e=(a===h?(b-c)/d+(b<c?6:0):b===h?(c-a)/d+2:(a-b)/d+4)/6,i=0.5<f?d/(2-h-g):d/(h+g));return[e,i,f]},hslToRgb:function(a,b,c){var d,e,f;d=[];if(0===b)c=b=d=255*c+0.5|0,d=[c,b,d];else{b=0.5>=c?c*(b+1):c+b-c*b;c=2*c-b;a+=1/3;for(e=0;3>e;)0>a?a+=1:1<a&&(a-=1),f=1>6*a?c+6*(b-c)*a:1>2*a?b:2>3*a?c+6*(b-c)*(2/3-a):c,d[e]=255*f+0.5|0,a-=1/3,e+=1}return d}},Translate:function(){},Scale:function(){},Rotate:function(){},Affine:function(){},UnsharpMask:function(){},
ConvolutionFilter:function(a,b,c,d,e,f,h,g,i,k){var m,p,l,n,w,F,j,o,u,r,t,B,y,A,S,q,C,D,E,K,L;C=a.data;D=a.width;q=a.height;a=this.utils.createImageData(D,q);j=a.data;e=e||1;f=f||0;!1!==h&&(h=!0);!1!==g&&(g=!0);i=i||0;u=0;b>>=1;F=c>>1;l=i>>16&255;c=i>>8&255;i&=255;p=255*(k||0);for(L=0;L<q;){for(K=0;K<D;){k=m=o=y=0;A=!1;t=0;E=void 0;for(S=-b;S<=b;){n=L+S;B=void 0;0<=n&&n<q?B=n*D:g?B=L*D:A=!0;for(n=-F;n<=F;)r=d[t++],0!==r&&(w=K+n,0<=w&&w<D||(g?w=K:A=!0),A?(y+=r*l,o+=r*c,m+=r*i,k+=r*p):(w=B+w<<2,y+=
r*C[w],o+=r*C[w+1],m+=r*C[w+2],k+=r*C[w+3])),n+=1;S+=1}j[u]=255<(E=y/e+f)?255:0>E?0:E|0;j[u+1]=255<(E=o/e+f)?255:0>E?0:E|0;j[u+2]=255<(E=m/e+f)?255:0>E?0:E|0;j[u+3]=h?C[u+3]:255<(E=k/e+f)?255:0>E?0:E|0;K+=1;u+=4}L+=1}return a},Binarize:function(a,b){var c,d,e,f,h,g;g=a.data;d=a.width;c=a.height;h=g.length;d=this.utils.createImageData(d,c);e=d.data;isNaN(b)&&(b=0.5);b*=255;for(f=0;f<h;)c=g[f]+g[f+1]+g[f+2]/3,e[f]=e[f+1]=e[f+2]=c<=b?0:255,e[f+3]=255,f+=4;return d},BlendAdd:function(a,b){var c,d,e,f,
h,g,i;g=a.data;d=a.width;c=a.height;h=g.length;d=this.utils.createImageData(d,c);e=d.data;c=b.data;i=void 0;for(f=0;f<h;)e[f]=255<(i=g[f]+c[f])?255:i,e[f+1]=255<(i=g[f+1]+c[f+1])?255:i,e[f+2]=255<(i=g[f+2]+c[f+2])?255:i,e[f+3]=255,f+=4;return d},BlendSubtract:function(a,b){var c,d,e,f,h,g,i;g=a.data;d=a.width;c=a.height;h=g.length;d=this.utils.createImageData(d,c);e=d.data;c=b.data;i=void 0;for(f=0;f<h;)e[f]=0>(i=g[f]-c[f])?0:i,e[f+1]=0>(i=g[f+1]-c[f+1])?0:i,e[f+2]=0>(i=g[f+2]-c[f+2])?0:i,e[f+3]=
255,f+=4;return d}};j.BoxBlur=function(){var a;a=function(a,c,d,e,f){var h,g,i,k,m,p,l,n,w,F,j,o,u,r;g=2*f+1;w=f+1;o=d-1;F=0;j=[];m=0;for(h=256*g;m<h;)j[m]=m/g|0,m+=1;u=0;for(r=[];u<e;){n=k=g=h=0;i=u;p=F<<2;n+=w*a[p];k+=w*a[p+1];g+=w*a[p+2];h+=w*a[p+3];for(m=1;m<=f;)p=F+(m<d?m:o)<<2,n+=a[p],k+=a[p+1],g+=a[p+2],h+=a[p+3],m+=1;for(m=0;m<d;)p=i<<2,c[p]=j[n],c[p+1]=j[k],c[p+2]=j[g],c[p+3]=j[h],p=m+w,p>o&&(p=o),l=m-f,0>l&&(l=0),p=F+p<<2,l=F+l<<2,n+=a[p]-a[l],k+=a[p+1]-a[l+1],g+=a[p+2]-a[l+2],h+=a[p+3]-
a[l+3],i+=e,m+=1;F+=d;r.push(u+=1)}return r};return function(b,c,d,e){var f,h,g,i,k,m;i=b.data;k=b.width;g=b.height;b=this.utils.createImageData(k,g);f=b.data;m=this.utils.createImageData(k,g).data;for(h=0;h<e;)a(h?f:i,m,k,g,c),a(m,f,g,k,d),h+=1;return b}}();j.GaussianBlur=function(a,b){var c,d,e;switch(b){case 2:e=5;d=[1,1,2,1,1,1,2,4,2,1,2,4,8,4,2,1,2,4,2,1,1,1,2,1,1];c=52;break;case 3:e=7;d=[1,1,2,2,2,1,1,1,2,2,4,2,2,1,2,2,4,8,4,2,2,2,4,8,16,8,4,2,2,2,4,8,4,2,2,1,2,2,4,2,2,1,1,1,2,2,2,1,1];c=140;
break;case 4:e=15;d=[2,2,3,4,5,5,6,6,6,5,5,4,3,2,2,2,3,4,5,7,7,8,8,8,7,7,5,4,3,2,3,4,6,7,9,10,10,11,10,10,9,7,6,4,3,4,5,7,9,10,12,13,13,13,12,10,9,7,5,4,5,7,9,11,13,14,15,16,15,14,13,11,9,7,5,5,7,10,12,14,16,17,18,17,16,14,12,10,7,5,6,8,10,13,15,17,19,19,19,17,15,13,10,8,6,6,8,11,13,16,18,19,20,19,18,16,13,11,8,6,6,8,10,13,15,17,19,19,19,17,15,13,10,8,6,5,7,10,12,14,16,17,18,17,16,14,12,10,7,5,5,7,9,11,13,14,15,16,15,14,13,11,9,7,5,4,5,7,9,10,12,13,13,13,12,10,9,7,5,4,3,4,6,7,9,10,10,11,10,10,9,7,
6,4,3,2,3,4,5,7,7,8,8,8,7,7,5,4,3,2,2,2,3,4,5,5,6,6,6,5,5,4,3,2,2];c=2044;break;default:e=3,d=[1,2,1,2,4,2,1,2,1],c=16}return j.ConvolutionFilter(a,e,e,d,c,0,!1)};j.StackBlur=function(){var a,b,c;a=function(){this.a=this.b=this.g=this.r=0;return this.next=null};b=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,
292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,
485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];c=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,
21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,
24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return function(d,e){var f,h,g,i,k,m,p,l,n,w,j,z,o,u,r,t,B,y,A,q,P,C,D,E,K,L,I,v,J,H,Q,M,O,R,G,N;I=d.width;L=d.height;p=this.Clone(d);l=p.data;r=void 0;f=e+e+1;M=I-1;z=L-1;D=e+1;Q=D*(D+1)/2;v=H=new a;J=void 0;u=b[e];K=c[e];for(o=1;o<f;)v=v.next=new a,o===D&&(J=v),o+=1;v.next=H;for(R=N=G=0;R<L;){q=n=i=f=C=j=m=g=0;P=D*(A=l[G]);w=D*(y=l[G+1]);k=D*(B=l[G+2]);h=D*(t=l[G+3]);C+=Q*A;j+=Q*y;m+=Q*B;g+=Q*t;v=H;for(o=0;o<D;)v.r=A,v.g=y,v.b=B,v.a=t,v=v.next,o+=1;
for(o=1;o<D;)r=G+((M<o?M:o)<<2),C+=(v.r=A=l[r])*(E=D-o),j+=(v.g=y=l[r+1])*E,m+=(v.b=B=l[r+2])*E,g+=(v.a=t=l[r+3])*E,q+=A,n+=y,i+=B,f+=t,v=v.next,o+=1;o=H;v=J;for(O=0;O<I;)l[G]=C*u>>K,l[G+1]=j*u>>K,l[G+2]=m*u>>K,l[G+3]=g*u>>K,C-=P,j-=w,m-=k,g-=h,P-=o.r,w-=o.g,k-=o.b,h-=o.a,r=N+((r=O+e+1)<M?r:M)<<2,q+=o.r=l[r],n+=o.g=l[r+1],i+=o.b=l[r+2],f+=o.a=l[r+3],C+=q,j+=n,m+=i,g+=f,o=o.next,P+=A=v.r,w+=y=v.g,k+=B=v.b,h+=t=v.a,q-=A,n-=y,i-=B,f-=t,v=v.next,G+=4,O+=1;N+=I;R+=1}for(O=0;O<I;){n=i=f=q=j=m=g=C=0;G=O<<
2;P=D*(A=l[G]);w=D*(y=l[G+1]);k=D*(B=l[G+2]);h=D*(t=l[G+3]);C+=Q*A;j+=Q*y;m+=Q*B;g+=Q*t;v=H;for(o=0;o<D;)v.r=A,v.g=y,v.b=B,v.a=t,v=v.next,o+=1;r=I;for(o=1;o<=e;)G=r+O<<2,C+=(v.r=A=l[G])*(E=D-o),j+=(v.g=y=l[G+1])*E,m+=(v.b=B=l[G+2])*E,g+=(v.a=t=l[G+3])*E,q+=A,n+=y,i+=B,f+=t,v=v.next,o<z&&(r+=I),o+=1;G=O;o=H;v=J;for(R=0;R<L;)r=G<<2,l[r]=C*u>>K,l[r+1]=j*u>>K,l[r+2]=m*u>>K,l[r+3]=g*u>>K,C-=P,j-=w,m-=k,g-=h,P-=o.r,w-=o.g,k-=o.b,h-=o.a,r=O+((r=R+D)<z?r:z)*I<<2,C+=q+=o.r=l[r],j+=n+=o.g=l[r+1],m+=i+=o.b=
l[r+2],g+=f+=o.a=l[r+3],o=o.next,P+=A=v.r,w+=y=v.g,k+=B=v.b,h+=t=v.a,q-=A,n-=y,i-=B,f-=t,v=v.next,G+=I,R+=1;O+=1}return p}}();j.Brightness=function(a,b){var c,d;d=a.data;c=this.utils.createImageData(a.width,a.height);this.utils.mapRGB(d,c.data,function(a){a+=b;return 255<a?255:a});return c};j.BrightnessContrastGimp=function(a,b,c){var d,e,f,h,g;g=a.data;e=a.width;f=a.height;a=g.length;e=this.utils.createImageData(e,f);f=e.data;h=Math.PI/4;b/=100;c*=0.99;c/=100;c=Math.tan((c+1)*h);for(h=d=0;h<a;)d+=
19595*g[h]+38470*g[h+1]+7471*g[h+2]>>16,h+=4;d/=a/4;this.utils.mapRGB(g,f,function(a){0>b?a*=1+b:0<b&&(a+=(255-a)*b);0!==c&&(a=(a-d)*c+d);return a+0.5|0});return e};j.BrightnessContrastPhotoshop=function(a,b,c){var d,e;e=a.data;a=this.utils.createImageData(a.width,a.height);d=a.data;b=(b+100)/100;c=(c+100)/100;this.utils.mapRGB(e,d,function(a){a*=b;a=(a-127.5)*c+127.5;return a+0.5|0});return a};j.Channels=function(a,b){var c;switch(b){case 2:c=[0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0];break;case 3:c=
[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0];break;default:c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0]}return this.ColorMatrixFilter(a,c)};j.Clone=function(a){return this.Copy(a,this.utils.createImageData(a.width,a.height))};j.CloneBuiltin=function(a){var b,c,d,e;e=a.width;d=a.height;b=this.utils.getSampleCanvas();c=this.utils.getSampleContext();b.width=e;b.height=d;c.putImageData(a,0,0);a=c.getImageData(0,0,e,d);b.width=0;b.height=0;return a};j.ColorMatrixFilter=function(a,b){var c,d,e,f,h,g,i,k,m,
p,l,n,j,q,z,o,u,r,t,B,y,A,H,J,C,D,E,K,L,I;L=a.data;d=a.width;c=a.height;K=L.length;e=this.utils.createImageData(d,c);f=e.data;i=b[0];k=b[1];t=b[2];B=b[3];y=b[4];A=b[5];H=b[6];J=b[7];C=b[8];D=b[9];m=b[10];p=b[11];l=b[12];n=b[13];j=b[14];q=b[15];z=b[16];o=b[17];u=b[18];r=b[19];I=void 0;for(g=0;g<K;)E=L[g],h=L[g+1],d=L[g+2],c=L[g+3],f[g]=255<(I=E*i+h*k+d*t+c*B+y)?255:0>I?0:I|0,f[g+1]=255<(I=E*A+h*H+d*J+c*C+D)?255:0>I?0:I|0,f[g+2]=255<(I=E*m+h*p+d*l+c*n+j)?255:0>I?0:I|0,f[g+3]=255<(I=E*q+h*z+d*o+c*u+
r)?255:0>I?0:I|0,g+=4;return e};j.ColorTransformFilter=function(a,b,c,d,e,f,h,g,i){var k,m,p,l,n;l=a.data;k=a.width;m=a.height;a=l.length;k=this.utils.createImageData(k,m);m=k.data;n=void 0;for(p=0;p<a;)m[p]=255<(n=l[p]*b+f)?255:0>n?0:n,m[p+1]=255<(n=l[p+1]*c+h)?255:0>n?0:n,m[p+2]=255<(n=l[p+2]*d+g)?255:0>n?0:n,m[p+3]=255<(n=l[p+3]*e+i)?255:0>n?0:n,p+=4;return k};j.Copy=function(a,b){var c,d,e;e=a.data;d=e.length;for(c=b.data;d--;)c[d]=e[d];return b};j.Crop=function(a,b,c,d,e){var f,h,g,i,k,m,p,l,
n,j;l=a.data;j=a.width;k=a.height;a=this.utils.createImageData(d,e);h=a.data;p=Math.max(b,0);f=Math.max(c,0);n=Math.min(b+d,j);e=Math.min(c+e,k);b=p-b;k=f;for(g=f-c;k<e;){i=p;for(c=b;i<n;)m=k*j+i<<2,f=g*d+c<<2,h[f]=l[m],h[f+1]=l[m+1],h[f+2]=l[m+2],h[f+3]=l[m+3],i+=1,c+=1;k+=1;g+=1}return a};j.CropBuiltin=function(a,b,c,d,e){var f,h,g,i;i=a.width;g=a.height;f=this.utils.getSampleCanvas();h=this.utils.getSampleContext();f.width=i;f.height=g;h.putImageData(a,0,0);a=h.getImageData(b,c,d,e);f.width=0;
f.height=0;return a};j.Desaturate=function(a){var b,c,d,e,f,h,g,i;i=a.data;d=a.width;e=a.height;a=i.length;d=this.utils.createImageData(d,e);e=d.data;for(h=0;h<a;)g=i[h],f=i[h+1],c=i[h+2],b=g>f?g>c?g:c:f>c?f:c,c=g<f?g<c?g:c:f<c?f:c,b=(b+c)/2+0.5|0,e[h]=e[h+1]=e[h+2]=b,e[h+3]=i[h+3],h+=4;return d};j.DisplacementMapFilter=function(a,b,c,d,e,f,h,g,i){var k,m,p,l,n,w,q,z,o,u,r,t;o=a.data;u=a.width;z=a.height;a=j.Clone(a);l=a.data;c||(c=0);d||(d=0);e||(e=0);f||(f=0);h||(h=0);g||(g=0);i||(i=2);q=b.width;
p=b.height;b=b.data;w=q+c;n=p+d;for(r=0;r<u;){for(t=0;t<z;)p=t*u+r<<2,r<c||t<d||r>=w||t>=n?k=p:(m=(t-d)*q+(r-c)<<2,k=b[m+e],k=r+((k-128)*h>>8),m=b[m+f],m=t+((m-128)*g>>8),k=j.utils.getPixelIndex(k+0.5|0,m+0.5|0,u,z,i),null===k&&(k=p)),l[p]=o[k],l[p+1]=o[k+1],l[p+2]=o[k+2],l[p+3]=o[k+3],t+=1;r+=1}return a};j.Dither=function(a,b){var c,d,e,f,h,g,i,k,m,p,l,n,j,q,z,o,u,r,t;o=a.width;q=a.height;c=this.Clone(a);d=c.data;b=2>b?2:255<b?255:b;p=void 0;m=[];p=b-1;k=i=0;g=void 0;for(g=0;g<b;)m[g]=255*g/p,g+=
1;p=this.utils.buildMap(function(){var a;a=m[i];k+=b;255<k&&(k-=255,i+=1);return a});l=n=j=e=f=h=e=f=h=l=n=j=g=t=r=void 0;u=o-1;z=q-1;for(t=0;t<q;){for(r=0;r<o;)g=t*o+r<<2,j=d[g],n=d[g+1],l=d[g+2],h=p[j],f=p[n],e=p[l],d[g]=h,d[g+1]=f,d[g+2]=e,h=j-h,f=n-f,e=l-e,g+=4,r<u&&(j=d[g]+0.4375*h,n=d[g+1]+0.4375*f,l=d[g+2]+0.4375*e,d[g]=255<j?255:0>j?0:j|0,d[g+1]=255<n?255:0>n?0:n|0,d[g+2]=255<l?255:0>l?0:l|0),g+=o-2<<2,0<r&&t<z&&(j=d[g]+0.1875*h,n=d[g+1]+0.1875*f,l=d[g+2]+0.1875*e,d[g]=255<j?255:0>j?0:j|0,
d[g+1]=255<n?255:0>n?0:n|0,d[g+2]=255<l?255:0>l?0:l|0),g+=4,t<z&&(j=d[g]+0.3125*h,n=d[g+1]+0.3125*f,l=d[g+2]+0.3125*e,d[g]=255<j?255:0>j?0:j|0,d[g+1]=255<n?255:0>n?0:n|0,d[g+2]=255<l?255:0>l?0:l|0),g+=4,r<u&&t<z&&(j=d[g]+0.0625*h,n=d[g+1]+0.0625*f,l=d[g+2]+0.0625*e,d[g]=255<j?255:0>j?0:j|0,d[g+1]=255<n?255:0>n?0:n|0,d[g+2]=255<l?255:0>l?0:l|0),r+=1;t+=1}return c};j.Edge=function(a){return j.ConvolutionFilter(a,3,3,[-1,-1,-1,-1,8,-1,-1,-1,-1])};j.Emboss=function(a){return j.ConvolutionFilter(a,3,3,
[-2,-1,0,-1,1,1,0,1,2])};j.Enrich=function(a){return j.ConvolutionFilter(a,3,3,[0,-2,0,-2,20,-2,0,-2,0],10,-40)};j.Flip=function(a,b){var c,d,e,f,h,g,i,k,m;g=a.data;i=a.width;f=a.height;c=this.utils.createImageData(i,f);e=c.data;for(m=0;m<f;){for(k=0;k<i;)h=m*i+k<<2,d=b?(f-m-1)*i+k<<2:m*i+(i-k-1)<<2,e[d]=g[h],e[d+1]=g[h+1],e[d+2]=g[h+2],e[d+3]=g[h+3],k+=1;m+=1}return c};j.Gamma=function(a,b){var c,d;d=a.data;c=this.utils.createImageData(a.width,a.height);this.utils.mapRGB(d,c.data,function(a){a=255*
Math.pow(a/255,1/b)+0.5;return 255<a?255:a+0.5|0});return c};j.GrayScale=function(a){var b,c,d,e,f;f=a.data;b=a.width;c=a.height;a=f.length;b=this.utils.createImageData(b,c);c=b.data;for(d=0;d<a;)e=19595*f[d]+38470*f[d+1]+7471*f[d+2]>>16,c[d]=c[d+1]=c[d+2]=e,c[d+3]=f[d+3],d+=4;return b};j.HSLAdjustment=function(a,b,c,d){var e,f,h,g,i,k,m,j,l;l=a.data;e=a.width;f=a.height;a=l.length;e=this.utils.createImageData(e,f);f=e.data;b/=360;c/=100;d/=100;m=this.utils.rgbToHsl;i=this.utils.hslToRgb;for(k=0;k<
a;){g=m(l[k],l[k+1],l[k+2]);for(h=g[0]+b;0>h;)h+=1;for(;1<h;)h-=1;j=g[1]+g[1]*c;0>j?j=0:1<j&&(j=1);g=g[2];0<d?g+=(1-g)*d:0>d&&(g+=g*d);h=i(h,j,g);f[k]=h[0];f[k+1]=h[1];f[k+2]=h[2];f[k+3]=l[k+3];k+=4}return e};j.Invert=function(a){var b;b=a.data;a=this.utils.createImageData(a.width,a.height);this.utils.mapRGB(b,a.data,function(a){return 255-a});return a};j.Mosaic=function(a,b){var c,d,e,f,h,g,i,k,m,j,l,n,w,q,z,o,u,r,t,B,y,A;q=a.data;z=a.width;w=a.height;h=this.utils.createImageData(z,w);g=h.data;f=
Math.ceil(z/b);l=Math.ceil(w/b);for(j=0;j<l;){A=j*b;y=A+b;y>w&&(y=w);for(e=0;e<f;){r=e*b;u=r+b;u>z&&(u=z);m=i=d=c=0;n=(u-r)*(y-A);for(t=A;t<y;){B=t*z;for(o=r;o<u;)k=B+o<<2,m+=q[k],i+=q[k+1],d+=q[k+2],c+=q[k+3],o+=1;t+=1}m=m/n+0.5|0;i=i/n+0.5|0;d=d/n+0.5|0;c=c/n+0.5|0;for(t=A;t<y;){B=t*z;for(o=r;o<u;)k=B+o<<2,g[k]=m,g[k+1]=i,g[k+2]=d,g[k+3]=c,o+=1;t+=1}e+=1}j+=1}return h};j.Oil=function(a,b,c){var d,e,f,h,g,i,k,m,j,l,n,q,F,z,o,u,r,t,B,y,A,H;B=a.data;y=a.width;t=a.height;i=this.utils.createImageData(y,
t);k=i.data;q=0;F=[];m=[];a=[];o=[];l=[];f=[];for(H=0;H<t;){for(A=0;A<y;){for(n=0;n<c;)F[n]=m[n]=a[n]=o[n]=l[n]=f[n]=0,n+=1;for(d=-b;d<=b;)if(h=H+d,!(0>h||h>=t)){n=h*y;for(h=-b;h<=b;)g=A+h,0>g||g>=y||(e=n+g<<2,r=B[e],g=B[e+1],u=B[e+2],z=r*c>>8,j=g*c>>8,e=u*c>>8,o[z]+=r,l[j]+=g,f[e]+=u,F[z]+=1,m[j]+=1,a[e]+=1,h+=1);d+=1}g=h=d=0;for(n=1;n<c;)F[n]>F[g]&&(g=n),m[n]>m[h]&&(h=n),a[n]>a[d]&&(d=n),n+=1;k[q]=o[g]/F[g]|0;k[q+1]=l[h]/m[h]|0;k[q+2]=f[d]/a[d]|0;k[q+3]=B[q+3];q+=4;A+=1}H+=1}return i};j.OpacityFilter=
function(a,b){var c,d,e,f,h;h=a.data;d=a.width;c=a.height;f=h.length;c=this.utils.createImageData(d,c);d=c.data;for(e=0;e<f;)d[e]=h[e],d[e+1]=h[e+1],d[e+2]=h[e+2],d[e+3]=b,e+=4;return c};j.Posterize=function(a,b){var c,d,e,f,h,g,i,k;k=a.data;c=this.utils.createImageData(a.width,a.height);d=c.data;b=2>b?2:255<b?255:b;g=[];i=b-1;h=f=0;e=void 0;for(e=0;e<b;)g[e]=255*e/i,e+=1;this.utils.mapRGB(k,d,function(){var a;a=g[f];h+=b;255<h&&(h-=255,f+=1);return a});return c};j.Rescale=function(a,b){var c,d;d=
a.data;c=this.utils.createImageData(a.width,a.height);this.utils.mapRGB(d,c.data,function(a){a*=b;return 255<a?255:a+0.5|0});return c};j.ResizeNearestNeighbor=function(a,b,c){var d,e,f,h,g,i,k,j,p,l;g=a.data;i=a.width;d=a.height;a=this.utils.createImageData(b,c);e=a.data;j=i/b;l=d/c;for(p=d=0;p<c;){f=(p*l|0)*i;for(k=0;k<b;)h=f+k*j<<2,e[d]=g[h],e[d+1]=g[h+1],e[d+2]=g[h+2],e[d+3]=g[h+3],d+=4,k+=1;p+=1}return a};j.Resize=function(a,b,c){var d,e,f,h,g,i,k,j,p;h=a.data;g=a.width;f=a.height;a=this.utils.createImageData(b,
c);e=a.data;k=g/b;p=f/c;for(j=d=0;j<c;){for(i=0;i<b;)this.utils.copyBilinear(h,i*k,j*p,g,f,e,d,0),d+=4,i+=1;j+=1}return a};j.ResizeBuiltin=function(a,b,c){var d,e,f,h;h=a.width;f=a.height;d=this.utils.getSampleCanvas();e=this.utils.getSampleContext();d.width=Math.max(h,b);d.height=Math.max(f,c);e.save();e.putImageData(a,0,0);e.scale(b/h,c/f);e.drawImage(d,0,0);a=e.getImageData(0,0,b,c);e.restore();d.width=0;d.height=0;return a};j.Sepia=function(a){var b,c,d,e,f,h,g,i;g=a.data;b=a.width;c=a.height;
a=g.length;c=this.utils.createImageData(b,c);d=c.data;i=void 0;for(f=0;f<a;)h=g[f],e=g[f+1],b=g[f+2],d[f]=255<(i=0.393*h+0.769*e+0.189*b)?255:0>i?0:i+0.5|0,d[f+1]=255<(i=0.349*h+0.686*e+0.168*b)?255:0>i?0:i+0.5|0,d[f+2]=255<(i=0.272*h+0.534*e+0.131*b)?255:0>i?0:i+0.5|0,d[f+3]=g[f+3],f+=4;return c};j.Sharpen=function(a,b){return j.ConvolutionFilter(a,3,3,[-b/16,-b/8,-b/16,-b/8,0.75*b+1,-b/8,-b/16,-b/8,-b/16])};j.Solarize=function(a){var b;b=a.data;a=this.utils.createImageData(a.width,a.height);this.utils.mapRGB(b,
a.data,function(a){return 127<a?2*(a-127.5):2*(127.5-a)});return a};j.Transpose=function(a){var b,c,d,e,f,h,g,i;f=a.data;h=a.width;d=a.height;a=this.utils.createImageData(d,h);c=a.data;for(i=0;i<d;){for(g=0;g<h;)e=i*h+g<<2,b=g*d+i<<2,c[b]=f[e],c[b+1]=f[e+1],c[b+2]=f[e+2],c[b+3]=f[e+3],g+=1;i+=1}return a};j.Twril=function(a,b,c,d,e,f,h){var g,i,k,j,p,l,n,q,F,z,o;q=a.data;F=a.width;n=a.height;a=this.utils.createImageData(F,n);j=a.data;b*=F;c*=n;e*=Math.PI/180;l=d*d;for(o=k=0;o<n;){for(z=0;z<F;)p=z-
b,g=o-c,i=p*p+g*g,i>l?(j[k]=q[k],j[k+1]=q[k+1],j[k+2]=q[k+2],j[k+3]=q[k+3]):(i=Math.sqrt(i),g=Math.atan2(g,p)+e*(d-i)/d,p=b+i*Math.cos(g),i=c+i*Math.sin(g),h?this.utils.copyBilinear(q,p,i,F,n,j,k,f):(i=(i+0.5|0)*F+(p+0.5|0)<<2,j[k]=q[i],j[k+1]=q[i+1],j[k+2]=q[i+2],j[k+3]=q[i+3])),k+=4,z+=1;o+=1}return a};q={};J=function(){var a,b;a=arguments[0];b=2<=arguments.length?N.call(arguments,1):[];a&&window.setTimeout.apply(window,[a,0].concat(N.call(b)));return b[0]};U=function(a,b){var c,d;c=null;for(d=
[];0<a.length||0<b.length;)"function"===typeof a[0]&&!c?c=x:null!==a[0]&&void 0!==a[0]?d.push(x):d.push(b[0]);if(c)return d.unshift(c);throw{name:"NoCallbackGiven",message:"This function needs a callback to work properly"};};q.getToolbox=T=function(a){var b,c;return[b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),c.data]};q.make=Y=function(a,b){var c;null==a&&(a=800);null==b&&(b=600);a.width&&a.height&&(c=a,a=c.width,b=c.height);c=document.createElement("canvas");c.width=a;c.height=b;
return c};q.newToolbox=M=function(a,b){return T(Y(a,b))};q.copy=W=function(a,b){var c;c=s.newToolbox(a)[0];ctx.drawImage(a,0,0,a.width,a.height);return J(b,c)};q.byImage=V=function(a,b){if(a.width&&a.height)return W(a,b);a.onload(function(){return V(a,b)});return!1};q.byArray=function(a,b,c,d){var e,f;e=M(b,c);b=e[0];c=e[1];f=e[3];for(e=0;e<f.length;)cx[e]=a[e],e+=1;c.putImageData(img,0,0);return J(d,b)};q.toImage=function(a,b){var c;c=new Image;c.src=a.toDataURL("image/png","");return J(b,c)};q.toArray=
function(a){var b,c;b=[];c=T(a)[3];Uint8Array&&(b=new Uint8Array(new ArrayBuffer(c.length)));for(a=0;a<c.length;)b[a]=c[a],a+=1;return b};q.resize=function(){var a,b,c,d,e,f;a=arguments[0];e=2<=arguments.length?N.call(arguments,1):[];c={};d={};e=U(e,800,600,0,0,void 0);c.width=e[1];c.height=e[2];d.width=e[3];d.height=e[4];b=e[5];e={};"width"===b?f="height":"height"===b?f="width":a.height>a.width?(b="height",f="width"):(b="width",f="height");a[b]>c[b]||a[f]>c[f]?(e[b]=a[f]*c[b]/a[b],e[f]=c[f],e[b]>
c[b]&&(e[f]=a[b]*c[f]/a[f],e[b]=c[b])):a[b]<d[b]||a[f]>d[f]?(e[b]=a[f]*d[b]/a[b],e[f]=d[f],e[b]<d[b]&&(e[f]=a[b]*d[f]/a[f],e[b]=d[b])):(e[b]=a[b],e[f]=a[f]);d=M(e.width,e.height);c=d[0];d[1].drawImage(a,0,0,e.width,e.height);return J(c)};q.rotateRight=function(a,b){var c;c=M(a)[1];c.rotate(90*Math.PI/180);c.drawImage(a,0,-1*a.height);return J(b,a)};q.rotateLeft=function(a,b){var c;c=M(a)[1];c.rotate(-90*Math.PI/180);c.drawImage(a,-1*a.width,0);return J(b,a)};q.flip=function(a,b){var c;c=M(a)[1];c.rotate(Math.PI);
c.drawImage(a,-1*a.width,-1*a.height);return J(b,a)};q.mirror=function(a,b){var c;c=M(a)[1];c.translate(c2.width/2,0);c.scale(-1,1);c.drawImage(a,-1*(c2.width/2),0);return J(b,a)};X=function(){var a,b,c,d,e,f,h;a=arguments[0];b=arguments[1];c=arguments[2];f=4<=arguments.length?N.call(arguments,3):[];h=T(a);a=h[0];d=h[2];h=M(a);a=h[0];e=h[1];J(function(){return e.putImageData(c.apply(null,[d].concat(N.call(f))),0,0)});return J(b,a)};H=function(){var a,b;b=arguments[0];a=2<=arguments.length?N.call(arguments,
1):[];return function(){var c,d,e;c=arguments[0];d=2<=arguments.length?N.call(arguments,1):[];e=U(d,a);d=e.shift();return X.apply(null,[c,d,b].concat(N.call(e)))}};q.binarize=H(j.Binarize,0.5);q.boxBlur=H(j.BoxBlur,3,3,2);q.gaussianBlur=H(j.GaussianBlur,2);q.stackBlur=H(j.StackBlur,6);q.brightness=H(j.brightness,1);q.brightnessConstrastGimp=H(j.BrightnessContrastGimp,1,1);q.brightnessConstrastPhotoshop=H(j.BrightnessContrastPhotoshop,1,1);q.Channels=function(a){return H(j.Channels,"blue"===a||"b"===
a?3:"green"===a||"g"===a?2:a)};q.invert=makeIfw(j.Invert);q.mosaic=makeIfw(j.Mosaic,10);window.Canio=q}).call(this);
